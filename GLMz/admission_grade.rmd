
## 0. Carreguem i anàlisi inicial
Carreguem les dades 
```{r}
library(readr)
data <- read_csv("../preprocessing/clean-data.csv", col_types = cols(
    Marital_status = col_character(),
    Application_mode = col_character(),
    Application_order = col_integer(),
    Course = col_character(),
    Daytime_evening_attendance = col_character(),
    Previous_qualification = col_character(),
    Previous_qualification_grade = col_double(),
    Nacionality = col_character(),
    Mother_s_qualification = col_integer(),
    Father_s_qualification = col_integer(),
    Mother_s_occupation = col_character(),
    Father_s_occupation = col_character(),
    Admission_grade = col_double(),
    Displaced = col_integer(),
    Educational_special_needs = col_integer(),
    Debtor = col_integer(),
    Tuition_fees_up_to_date = col_integer(),
    Gender = col_integer(),
    Scholarship_holder = col_integer(),
    Age_at_enrollment = col_integer(),
    International = col_integer(),
    Curricular_units_1st_sem_credited = col_integer(),
    Curricular_units_1st_sem_enrolled = col_integer(),
    Curricular_units_1st_sem_evaluations = col_integer(),
    Curricular_units_1st_sem_approved = col_integer(),
    Curricular_units_1st_sem_grade = col_double(),
    Curricular_units_1st_sem_without_evaluations = col_integer(),
    Curricular_units_2nd_sem_credited = col_integer(),
    Curricular_units_2nd_sem_enrolled = col_integer(),
    Curricular_units_2nd_sem_evaluations = col_integer(),
    Curricular_units_2nd_sem_approved = col_integer(),
    Curricular_units_2nd_sem_grade = col_double(),
    Curricular_units_2nd_sem_without_evaluations = col_integer(),
    Unemployment_rate = col_double(),
    Inflation_rate = col_double(),
    GDP = col_double(),
    Target = col_character()
  )
)
```


Descriptiva previa de la variable a estudiar (Admission_grade)
```{r}
summary(data$Admission_grade)
hist(data$Admission_grade)
```

## 1. Model complet i model nul

Construim un mlgz sobre la variable a estudiar i fem el summary
```{r}
model_complet <- glm(Admission_grade ~ . - Target, data = data, family = gaussian())
summary(model_complet)
```


Construim el model nul
```{r}
model_nul <- glm(Admission_grade ~ 1, data = data, family = gaussian)
```


Comparem el model complet amb el model nul, per assegurar-nos de que tot funciona correctament (utilitzem el test anova)
```{r}
anova(model_complet, model_nul, test="Chisq")
```


## 2. Construcció d'un model amb les variables més significatives

Construïm el model
```{r}
# Ajusta el model amb les variables més significatives
model_1 <- glm(Admission_grade ~ 
                       Application_mode + 
                       Course + 
                       Previous_qualification + 
                       Previous_qualification_grade + 
                       Age_at_enrollment + 
                       Unemployment_rate + 
                       Application_order + 
                       Curricular_units_1st_sem_evaluations + 
                       GDP, 
                     data = data, 
                     family = gaussian())


```

Comparem el model que hem fet amb el model complet, per assegurar-nos de que tot funciona correctament (utilitzem el test anova)
```{r}
anova(model_1, model_complet, test="Chisq")
```


## 3. Construim un model reduit utilitzant la comanda step, per eliminar variables redundants.
```{r}
model_final <- step(model_complet, direction = "both")
```

Comparem el nou model reduit amb el model anterior, per assegurar-nos de que no hi han diferències estadísticament significatives
```{r}
anova(model_complet, model_final, test="Chisq")
```
Mirem la puntuació AIC d'ambdós models
```{r}
AIC(model_complet)
AIC(model_final)
```

## 4. Validació del model


Visualitzem diferents gràfics per veure que tan bé funciona el nostre model

```{r}
library(car)
residualPlot(model_final)
```

```{r}
library(car)
residualPlots(model_final, layout = c(2, 2), ask = FALSE)
```

```{r}
influencePlot(model = model_final)
```
